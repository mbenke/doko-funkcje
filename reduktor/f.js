function NoOp(){}NoOp.prototype={constructor:NoOp,type:function(){throw new DeletedFunction;},children:function(){return[]},getName:function(){throw new DeletedFunction;},cloneWithSideEffects:function(){throw new DeletedFunction;},replaceChild:function(){throw new DeletedFunction;},hardDestroy:function(){},softDestroy:function(){},makeJQueryHTMLObject:function(){throw new DeletedFunction;},isRedex:function(){return!1},canApply:function(){return!1}};var Operations={IPlus:1,ITimes:2,IDivides:3,IEquals:4,IMinus:5};function OpP(a,b){this.depth=0;this.display=null;this.value=b;this.op=a}
OpP.prototype={constructor:OpP,type:function(){return Type.OpP},children:function(){return[]},getName:function(){return this.value.toString()},cloneWithSideEffects:function(){return new OpP(this.op,this.value)},replaceChild:function(a,b){throw new NoChild;},hardDestroy:function(){this.display=this.parent=null},softDestroy:function(){this.display=this.parent=null},makeJQueryHTMLObject:function(){this.depth=this.parent.depth+1;var a=$("<span>");switch(this.op){case Operations.IPlus:a.append("+");break;
case Operations.IMinus:a.append("-");break;case Operations.ITimes:a.append("*");break;case Operations.IDivides:a.append("/");break;case Operations.IEquals:a.append("==");break;default:return!1}0<=this.value&&a.append("<sub>"+this.value+"</sub>");this.parent.isRedex()&&this.parent.left==this&&(a.addClass("bindingspot"),a.data("redex",this.parent));this.display=a;a.data("term",this);return a},isRedex:function(){return!1},canApply:function(a){switch(this.op){case Operations.IPlus:case Operations.ITimes:case Operations.IDivides:case Operations.IEquals:case Operations.IMinus:return a.type()==
Type.Int;default:return!1}},applyTo:function(a){var b;if(0<=this.value)switch(this.op){case Operations.IPlus:b=new Int(+this.value+ +a.value);break;case Operations.IMinus:a=+this.value-+a.value;b=new Int(0>a?0:a);break;case Operations.ITimes:b=new Int(+this.value*+a.value);break;case Operations.IDivides:b=new Int(+this.value/+a.value|0);break;case Operations.IEquals:b=+this.value==+a.value?Term.constant.$true.head.child.cloneWithSideEffects():Term.constant.$false.head.child.cloneWithSideEffects();
break;default:return!1}else b=this,this.value=a.value;this.parent.parent.replaceChild(this.parent,b)}};function Int(a){this.depth=0;this.display=null;this.value=a}
Int.prototype={constructor:Int,type:function(){return Type.Int},children:function(){return[]},getName:function(){return this.value.toString()},cloneWithSideEffects:function(){return new Int(this.value)},replaceChild:function(a,b){throw Error("No Child");},hardDestroy:function(){this.display=this.parent=null},softDestroy:function(){this.display=this.parent=null},makeJQueryHTMLObject:function(){this.depth=this.parent.depth+1;var a=$("<span>");a.append(this.value);this.display=a;a.data("term",this);
return a},isRedex:function(){return!1},canApply:function(){return!1}};function AbsTerm(a,b,c){this.depth=0;this.display=null;this.boundVars=[];this.term=b;this.name=c||"_";b.parent=this;for(b=0;b<a.length;++b){c=a[b];var d=new BoundVar(this);c.parent.replaceChild(c,d)}}
AbsTerm.prototype={constructor:AbsTerm,type:function(){return Type.AbsTerm},children:function(){return[this.term]},getName:function(){return this.boundVars.length?this.name:"_"},cloneWithSideEffects:function(){var a=this.boundVars,b=this.getName();this.boundVars=[];var c=this.term.cloneWithSideEffects(),b=new AbsTerm(this.boundVars,c,b);this.boundVars=a;return b},replaceChild:function(a,b){if(this.term===a)this.term=b,b.parent=this;else throw new InvalidArguments("Method not invoked on parent of child");
},hardDestroy:function(){this.display=this.parent=null;this.term.hardDestroy();this.boundVars=this.term=null},softDestroy:function(){this.display=this.parent=null;this.term.softDestroy()},makeJQueryHTMLObject:function(){var a=this.parent;this.depth=a.depth+1;var b=$("<span>");this.name=Utility.getUnblemishedName(this.getName());var c=$("<span>");c.append("\u03bb"+this.getName());if("_"!=this.name){var d=$("<sub>");d.text(this.depth);b.append(c,d,".",this.term.makeJQueryHTMLObject())}else b.append(c,
".",this.term.makeJQueryHTMLObject());a.type()==Type.AppTerm&&a.left===this&&(c.addClass("bindingspot"),c.data("redex",this.parent));this.display=b;b.data("term",this);return b},isRedex:function(){return!1},canApply:function(a){return!0},applyTo:function(a){var b=this.boundVars,c;if(b&&b.length)for(c=b.shift(),c.parent.replaceChild(c,a);b.length;){c=b.shift();var d=a.cloneWithSideEffects();c.parent.replaceChild(c,d)}else a.hardDestroy();this.parent.parent.replaceChild(this.parent,this.term);return!0}};function RefCount(a){this.n=a}RefCount.prototype={constructor:RefCount,incr:function(){++this.n},decr:function(){--this.n},valueOf:function(){return this.n}};function LetAbbr(a,b,c){this.depth=0;this.display=null;this.name=a;this.abbr=b;c?(this.refcounter=c,c.incr()):this.refcounter=new RefCount(1)}
LetAbbr.prototype={constructor:LetAbbr,type:function(){return Type.LetAbbr},children:function(){return[]},getName:function(){return this.name},cloneWithSideEffects:function(){return new LetAbbr(this.name,this.abbr,this.refcounter)},replaceChild:function(a,b){if(this.abbr===a)this.abbr=b,b.parent=this;else throw new InvalidArguments("Method not invoked on parent of child");},hardDestroy:function(){this.display=this.parent=null;this.refcounter.decr();+this.refcounter||this.abbr.hardDestroy()},softDestroy:function(){this.abbr=
this.display=this.parent=null},makeJQueryHTMLObject:function(){this.depth=this.parent.depth+1;var a=$("<span>"),b=Utility.getUnblemishedName(this.name),a=a.append(b);a.addClass("bindingspot");a.data("redex",this);this.display=a;a.data("term",this);return a},isRedex:function(){return!0},canApply:function(){return!1},isPreproccessed:function(){return!0},contractRedex:function(){1<this.refcounter?this.parent.replaceChild(this,this.abbr.child.cloneWithSideEffects()):this.parent.replaceChild(this,this.abbr.child)},
illuminate:function(){this.display.addClass("abbreviationredex")},unilluminate:function(){this.display.removeClass("abbreviationredex")}};function AppTerm(a,b){this.depth=0;this.display=null;this.left=a;this.right=b;a.parent=this;b.parent=this}
AppTerm.prototype={constructor:AppTerm,type:function(){return Type.AppTerm},children:function(){return[this.right,this.left]},getName:function(){throw Error("Invalid Type");},cloneWithSideEffects:function(){var a=this.left.cloneWithSideEffects(),b=this.right.cloneWithSideEffects();return new AppTerm(a,b)},replaceChild:function(a,b){if(this.left===a)this.left=b,b.parent=this;else if(this.right===a)this.right=b,b.parent=this;else throw Error("Method not invoked on parent of child");},hardDestroy:function(){this.display=
this.parent=null;this.left.hardDestroy();this.right.hardDestroy();this.right=this.left=null},softDestroy:function(){this.display=this.parent=null;this.left.softDestroy();this.right.softDestroy()},makeJQueryHTMLObject:function(){this.depth=this.parent.depth+1;var a=$("<span>"),b=this.left,c=this.right,d=b.makeJQueryHTMLObject(),e=c.makeJQueryHTMLObject(),h=!1;b.type()==Type.AbsTerm?(a.append("(",d,")",$("<wbr>")),h=!0):a.append(d);c.type()==Type.AbsTerm||c.type()==Type.AppTerm?a.append($("<wbr>"),
"(",e,")"):(h||a.append(" "),a.append(e));this.display=a;a.data("term",this);return a},isRedex:function(){return this.left.canApply(this.right)},canApply:function(a){return!1},isPreproccessed:function(){return!1},contractRedex:function(){this.left.applyTo(this.right)},illuminate:function(){this.left.display.addClass("lefttermredex");this.right.display.addClass("righttermredex");if(this.left.type()==Type.AbsTerm)for(var a=this.left.boundVars,b=0;b<a.length;++b)a[b].display.addClass("activeboundvar")},
unilluminate:function(){this.left.display.removeClass("lefttermredex");this.right.display.removeClass("righttermredex");var a=this.left.boundVars;if(this.left.type()==Type.AbsTerm)for(var b=0;b<a.length;++b)a[b].display.removeClass("activeboundvar")}};function FreeVar(a,b){this.depth=0;this.display=null;this.name=a;this.registry=b;b[a]||(b[a]=[]);b[a].push(this)}
FreeVar.prototype={constructor:FreeVar,type:function(){return Type.FreeVar},children:function(){return[]},getName:function(){return this.name},cloneWithSideEffects:function(){return new FreeVar(this.name,this.registry)},replaceChild:function(a,b){throw Error("No Child");},hardDestroy:function(){this.display=this.parent=null;var a=this.registry[this.name],b=a.indexOf(this);a.splice(b,1);this.registry=null},softDestroy:function(){this.display=this.parent=null},makeJQueryHTMLObject:function(){this.depth=
this.parent.depth+1;var a=$("<span>"),b=Utility.getUnblemishedName(this.name);this.display=a=a.append(b);a.data("term",this);return a},isRedex:function(){return!1},canApply:function(){return!1}};function FunTerm(a,b,c){this.depth=0;this.display=null;for(var d=b.length,e=new NoOp,h=e,s=0;s<b.length;++s)h=new AppTerm(h,b[s]);this.arity=d;this.name=a;this.templateTerm=c;this.underlying=h;this.leftmost=e;this.contractable=!1;this.templateTerm.parent=this;this.underlying.parent=this}
FunTerm.prototype={constructor:FunTerm,type:function(){return Type.FunTerm},children:function(){return[this.underlying]},getName:function(){return this.name},cloneWithSideEffects:function(a){for(var b=[],c=this.underlying,d=0;d<this.arity;++d)c=c.right.cloneWithSideEffects(a),b.unshift(c),c=this.underlying.left;a=this.templateTerm.cloneWithSideEffects(a);b=new FunTerm(this.name,b,a);b.contractable=this.contractable;return b},replaceChild:function(a,b){if(this.underlying===a)this.underlying=b,b.parent=
this;else if(this.templateTerm===a)this.templateTerm=b,b.parent=this,this.contractable=!0;else throw new InvalidArguments("Method not invoked on parent of child");},hardDestroy:function(){this.display=this.parent=null;this.templateTerm.hardDestroy();this.underlying.hardDestroy();this.lambdaList=null},softDestroy:function(){this.display=this.parent=null;this.underlying.softDestroy()},makeJQueryHTMLObject:function(){this.depth=this.parent.depth+1;var a=$("<span>"),b=$("<span>");b.append(this.name);
this.isRedex()&&(b.addClass("bindingspot"),b.data("redex",this));a.append(b,"(");var b=$("<span>"),c=this.underlying;this.underlying.depth=this.depth;if(this.arity){b.append(c.right.makeJQueryHTMLObject());for(var c=c.left,d=1;d<this.arity;++d)b.prepend(c.right.makeJQueryHTMLObject(),","),c=c.left}a.append(b,")");this.display=a;a.data("term",this);return a},isRedex:function(){return this.contractable},canApply:function(){return!1},isPreproccessed:function(){return!0},contractRedex:function(){var a=
this.leftmost.parent;a.replaceChild(this.leftmost,this.templateTerm);for(var b=0;b<this.arity&&a.isRedex();++b)a.contractRedex(),a=a.parent;this.parent.replaceChild(this,this.underlying)},illuminate:function(){this.display.addClass("abbreviationredex")},unilluminate:function(){this.display.removeClass("abbreviationredex")}};function StrTerm(a){this.depth=0;this.display=null;this.value=a}
StrTerm.prototype={constructor:StrTerm,type:function(){return Type.StrTerm},children:function(){return[]},getName:function(){return'"'+this.value+'"'},cloneWithSideEffects:function(){return new StrTerm(this.value)},replaceChild:function(a,b){throw new NoChild;},hardDestroy:function(){this.display=this.parent=null},softDestroy:function(){this.display=this.parent=null},makeJQueryHTMLObject:function(){this.depth=this.parent.depth+1;var a=$("<span>");a.append('"'+this.value+'"');this.parent.isRedex()&&
this.parent.left==this&&(a.addClass("bindingspot"),a.data("redex",this.parent));this.display=a;a.data("term",this);return a},isRedex:function(){return!1},canApply:function(a){return a.type()==Type.StrTerm},applyTo:function(a){this.value+=a.value;this.parent.parent.replaceChild(this.parent,this)}};function BoundVar(a){this.depth=0;this.display=null;this.boundAt=a;a.boundVars.push(this)}
BoundVar.prototype={constructor:BoundVar,type:function(){return Type.BoundVar},children:function(){return[]},getName:function(){return this.boundAt.name},cloneWithSideEffects:function(){return new BoundVar(this.boundAt)},replaceChild:function(a,b){throw Error("No Child");},hardDestroy:function(){this.display=this.parent=null;var a=this.boundAt.boundVars,b=a.indexOf(this);a.splice(b,1)},softDestroy:function(){this.display=this.parent=null},makeJQueryHTMLObject:function(){this.depth=this.parent.depth+
1;var a=$("<span>"),b=$("<sub>");b.text(this.boundAt.depth);a.append(this.getName(),b);a.data("term",this);return this.display=a},isRedex:function(){return!1},canApply:function(a){return!1}};function Sentinel(a){this.depth=0;this.display=null;this.child=a;a.parent=this}
Sentinel.prototype={constructor:Sentinel,type:function(){return Type.Sentinel},children:function(){return[this.child]},getName:function(){throw new UnexpectedType("Sentinel");},cloneWithSideEffects:function(){return new Sentinel(this.child.cloneWithSideEffects())},replaceChild:function(a,b){if(this.child===a)this.child=b,b.parent=this;else throw new InvalidArguments("Method not invoked on parent of child");},hardDestroy:function(){this.display=this.parent=null;this.child&&this.child.hardDestroy();
this.child=null},softDestroy:function(){this.display=this.parent=null;this.child.softDestroy()},makeJQueryHTMLObject:function(){return this.child.makeJQueryHTMLObject()},isRedex:function(){return!1},canApply:function(){return!1}};var Utility={normalizeLimit:5E3,getUnblemishedName:function(a){return/^(.+?)(<sub>)?[0-9]*(<\/sub>)?$/.exec(a)[1]}},Type={FreeVar:1,BoundVar:2,FunTerm:3,AbsTerm:4,AppTerm:5,SentinelTerm:6,LetAbbr:7,StrTerm:8,Int:9,OpP:10},Semantic={contract:[]};var parser=function(){function a(){this.yy={}}var b=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},c=[1,4],d=[1,5],e=[1,13],h=[1,7],s=[1,10],r=[1,14],n=[1,16],y=[1,17],v=[1,20],m=[1,21],k=[1,22],t=[1,23],u=[1,24],l=[1,25],w=[1,26],z=[1,27],A=[1,28],B=[1,29],C=[1,30],p=[1,18],g=[1,31],E=[5,10],D=[5,10,16,19],q=[5,10,14,16,19,21,23,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41],F=[1,44],b={trace:function(){},yy:{},symbols_:{error:2,start:3,letexpression:4,EOF:5,lambdaterm:6,LET:7,
varname:8,EQ:9,IN:10,LETREC:11,fundecl:12,funname:13,BG:14,varlist:15,EG:16,funinst:17,lambdalist:18,SEP:19,dotfreeterm:20,DOT:21,dottedabstraction:22,LAM:23,atom:24,QUOTE:25,arithmetic:26,NORMALIZE:27,CONSTANT:28,INT:29,IPLUS:30,IPLUSNUM:31,ITIMES:32,ITIMESNUM:33,IDIV:34,IDIVNUM:35,IMINUS:36,IMINUSNUM:37,IEQ:38,IEQNUM:39,LVAR:40,UVAR:41,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LET",9:"EQ",10:"IN",11:"LETREC",14:"BG",16:"EG",19:"SEP",21:"DOT",23:"LAM",25:"QUOTE",27:"NORMALIZE",28:"CONSTANT",
29:"INT",30:"IPLUS",31:"IPLUSNUM",32:"ITIMES",33:"ITIMESNUM",34:"IDIV",35:"IDIVNUM",36:"IMINUS",37:"IMINUSNUM",38:"IEQ",39:"IEQNUM",40:"LVAR",41:"UVAR"},productions_:[0,[3,2],[4,1],[4,6],[4,6],[4,6],[12,4],[12,3],[17,4],[17,3],[15,1],[15,3],[18,1],[18,3],[6,1],[6,2],[6,3],[6,1],[6,2],[22,4],[22,3],[20,1],[20,2],[24,1],[24,1],[24,3],[24,3],[24,1],[24,1],[24,2],[24,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[8,1],[13,1]],performAction:function(a,b,c,d,e,f,h){a=f.length-
1;switch(e){case 1:return semanticAnalysis(f[a-1]);case 2:case 14:case 15:case 17:case 21:case 24:case 28:case 42:case 43:this.$=f[a];break;case 3:this.$=LetExpr.contractLet(f[a-4],f[a-2],f[a]);break;case 4:this.$=LetExpr.contractLet(f[a-4],Term.makeApp(Term.makeConstant("$Y"),Term.makeAbs(f[a-4],f[a-2])),f[a]);break;case 5:this.$=LetExpr.contractFunLet(f[a-4],f[a-2],f[a]);break;case 6:this.$={name:f[a-3],varlist:f[a-1]};break;case 7:this.$={name:f[a-2],varlist:[]};break;case 8:this.$=Term.makeFunction(f[a-
3],f[a-1]);break;case 9:this.$=Term.makeFunction(f[a-2],[]);break;case 10:case 12:this.$=[f[a]];break;case 11:case 13:f[a].unshift(f[a-2]);this.$=f[a];break;case 16:this.$=Term.makeApp(f[a-2],f[a]);break;case 18:case 22:this.$=Term.makeApp(f[a-1],f[a]);break;case 19:this.$=Term.makeAbs(f[a-2],f[a]);break;case 20:case 26:this.$=Term.makeAbs(f[a-1],f[a]);break;case 23:this.$=Term.makeVar(f[a]);break;case 25:this.$=f[a-1];break;case 27:this.$=Term.makeString(f[a].slice(1,-1));break;case 29:Semantic.contract.push(f[a].head.child);
this.$=f[a];break;case 30:this.$=Term.makeConstant(f[a]);break;case 31:this.$=Term.makeInt(f[a]);break;case 32:this.$=Term.makeOp(Operations.IPlus,-1);break;case 33:this.$=Term.makeOp(Operations.IPlus,f[a].slice(1));break;case 34:this.$=Term.makeOp(Operations.ITimes,-1);break;case 35:this.$=Term.makeOp(Operations.ITimes,f[a].slice(1));break;case 36:this.$=Term.makeOp(Operations.IDivides,-1);break;case 37:this.$=Term.makeOp(Operations.IDivides,f[a].slice(1));break;case 38:this.$=Term.makeOp(Operations.IMinus,
-1);break;case 39:this.$=Term.makeOp(Operations.IMinus,f[a].slice(1));break;case 40:this.$=Term.makeOp(Operations.IEquals,-1);break;case 41:this.$=Term.makeOp(Operations.IEquals,f[a].slice(2))}},table:[{3:1,4:2,6:3,7:c,8:11,11:d,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{1:[3]},{5:[1,32]},b(E,[2,2]),{8:33,12:34,13:35,40:p,41:g},{8:36,40:p},b(D,[2,14],{8:11,17:12,26:15,13:19,22:38,24:39,14:e,21:[1,37],23:s,25:r,
27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g}),{6:40,8:11,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},b(D,[2,17]),b(q,[2,21]),{8:41,40:p},b(q,[2,23]),b(q,[2,24]),{6:42,8:11,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},b(q,[2,27]),b(q,[2,28]),{8:11,13:19,14:e,17:12,23:F,24:43,25:r,26:15,27:n,28:y,29:v,
30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},b(q,[2,30]),b([5,9,10,14,16,19,21,23,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41],[2,42]),{14:[1,45]},b(q,[2,31]),b(q,[2,32]),b(q,[2,33]),b(q,[2,34]),b(q,[2,35]),b(q,[2,36]),b(q,[2,37]),b(q,[2,38]),b(q,[2,39]),b(q,[2,40]),b(q,[2,41]),{14:[2,43]},{1:[2,1]},{9:[1,46]},{9:[1,47]},{14:[1,48]},{9:[1,49]},{6:50,8:11,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},
b(D,[2,18]),b(q,[2,22]),b(D,[2,15]),{8:11,13:19,14:e,17:12,21:[1,51],22:52,23:s,24:53,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{16:[1,54]},b(q,[2,29]),{8:55,40:p},{6:58,8:11,13:19,14:e,16:[1,57],17:12,18:56,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{4:59,6:3,7:c,8:11,11:d,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,
39:C,40:p,41:g},{4:60,6:3,7:c,8:11,11:d,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{8:63,15:61,16:[1,62],40:p},{4:64,6:3,7:c,8:11,11:d,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},b(D,[2,16]),{6:65,8:11,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},
b(D,[2,20]),b(q,[2,26]),b(q,[2,25]),{8:11,13:19,14:e,17:12,23:F,24:53,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{16:[1,66]},b(q,[2,9]),{16:[2,12],19:[1,67]},{10:[1,68]},{10:[1,69]},{16:[1,70]},{9:[2,7]},{16:[2,10],19:[1,71]},{10:[1,72]},b(D,[2,19]),b(q,[2,8]),{6:58,8:11,13:19,14:e,17:12,18:73,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{4:74,6:3,7:c,8:11,11:d,13:19,14:e,17:12,20:6,21:h,
22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{4:75,6:3,7:c,8:11,11:d,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{9:[2,6]},{8:63,15:76,40:p},{4:77,6:3,7:c,8:11,11:d,13:19,14:e,17:12,20:6,21:h,22:8,23:s,24:9,25:r,26:15,27:n,28:y,29:v,30:m,31:k,32:t,33:u,34:l,35:w,36:z,37:A,38:B,39:C,40:p,41:g},{16:[2,13]},b(E,[2,3]),b(E,[2,5]),{16:[2,11]},b(E,[2,4])],defaultActions:{31:[2,
43],32:[2,1],62:[2,7],70:[2,6],73:[2,13],76:[2,11]},parseError:function(a,b){if(b.recoverable)this.trace(a);else throw Error(a);},parse:function(a){var b=[0],c=[null],d=[],e=this.table,f="",h=0,p=0,q=0,s=d.slice.call(arguments,1),g=Object.create(this.lexer),r={},n;for(n in this.yy)Object.prototype.hasOwnProperty.call(this.yy,n)&&(r[n]=this.yy[n]);g.setInput(a,r);r.lexer=g;r.parser=this;"undefined"==typeof g.yylloc&&(g.yylloc={});n=g.yylloc;d.push(n);var y=g.options&&g.options.ranges;this.parseError=
"function"===typeof r.parseError?r.parseError:Object.getPrototypeOf(this).parseError;for(var x,v,m,k,t={},u,l;;){m=b[b.length-1];if(this.defaultActions[m])k=this.defaultActions[m];else{if(null===x||"undefined"==typeof x)x=void 0,x=g.lex()||1,"number"!==typeof x&&(x=this.symbols_[x]||x);k=e[m]&&e[m][x]}if("undefined"===typeof k||!k.length||!k[0]){var w="";l=[];for(u in e[m])this.terminals_[u]&&2<u&&l.push("'"+this.terminals_[u]+"'");w=g.showPosition?"Parse error on line "+(h+1)+":\n"+g.showPosition()+
"\nExpecting "+l.join(", ")+", got '"+(this.terminals_[x]||x)+"'":"Parse error on line "+(h+1)+": Unexpected "+(1==x?"end of input":"'"+(this.terminals_[x]||x)+"'");this.parseError(w,{text:g.match,token:this.terminals_[x]||x,line:g.yylineno,loc:n,expected:l})}if(k[0]instanceof Array&&1<k.length)throw Error("Parse Error: multiple actions possible at state: "+m+", token: "+x);switch(k[0]){case 1:b.push(x);c.push(g.yytext);d.push(g.yylloc);b.push(k[1]);x=null;v?(x=v,v=null):(p=g.yyleng,f=g.yytext,h=
g.yylineno,n=g.yylloc,0<q&&q--);break;case 2:l=this.productions_[k[1]][1];t.$=c[c.length-l];t._$={first_line:d[d.length-(l||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(l||1)].first_column,last_column:d[d.length-1].last_column};y&&(t._$.range=[d[d.length-(l||1)].range[0],d[d.length-1].range[1]]);m=this.performAction.apply(t,[f,p,h,r,k[1],c,d].concat(s));if("undefined"!==typeof m)return m;l&&(b=b.slice(0,-2*l),c=c.slice(0,-1*l),d=d.slice(0,-1*l));b.push(this.productions_[k[1]][0]);
c.push(t.$);d.push(t._$);k=e[b[b.length-2]][b[b.length-1]];b.push(k);break;case 3:return!0}}}},c=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&
(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;
a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+
this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=
this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,
last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+
1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);
this.done&&this._input&&(this.done=!1);if(c)return c;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;
return a?(a=this.test_match(a,d[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-
1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 0:this.begin("COMMENT");break;case 1:this.begin("INITIAL");break;case 3:throw Error("multiline comment not closed");case 4:return"QUOTE";
case 7:return"LAM";case 8:return"BG";case 9:return"EG";case 10:return"DOT";case 11:return"SEP";case 12:return"IMINUSNUM";case 13:return"IMINUS";case 14:return"IPLUSNUM";case 15:return"IPLUS";case 16:return"ITIMESNUM";case 17:return"ITIMES";case 18:return"IDIVNUM";case 19:return"IDIV";case 20:return"IEQNUM";case 21:return"IEQ";case 22:return"EQ";case 23:return"LET";case 24:return"LETREC";case 25:return"IN";case 26:return"NORMALIZE";case 27:return"INT";case 28:return"CONSTANT";case 29:return"LVAR";
case 30:return"UVAR";case 31:return"EOF"}},rules:[/^(?:\/\*)/,/^(?:\*\/)/,/^(?:([^*]|\n)+|.)/,/^(?:$)/,/^(?:"(\\.|[^\\"])*")/,/^(?:\s+)/,/^(?:\/\/.*)/,/^(?:\\|\u03BB)/,/^(?:\()/,/^(?:\))/,/^(?:\.)/,/^(?:,)/,/^(?:-[0-9]+)/,/^(?:-)/,/^(?:\+[0-9]+)/,/^(?:\+)/,/^(?:\*[0-9]+)/,/^(?:\*)/,/^(?:\/[0-9]+)/,/^(?:\/)/,/^(?:==[0-9]+)/,/^(?:==)/,/^(?:=)/,/^(?:let\b)/,/^(?:letrec\b)/,/^(?::)/,/^(?:!)/,/^(?:[0-9]+)/,/^(?:\$[a-zA-Z\`\~\!\@\#\%\^\&\*\-\_\{\}\[\]\|\;\'\<\>\?]+)/,/^(?:[a-z\`\~\!\@\#\%\^\&\_\{\}\[\]\|\;\'\<\>\?][A-Za-z0-9\`\~\!\@\#\%\^\&\_\{\}\[\]\|\;\'\<\>\?]*)/,
/^(?:[A-Z][_a-zA-Z0-9]*)/,/^(?:$)/],conditions:{COMMENT:{rules:[1,2,3],inclusive:!1},INITIAL:{rules:[0,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!0}}}}();b.lexer=c;a.prototype=b;b.Parser=a;return new a}();
"undefined"!==typeof require&&"undefined"!==typeof exports&&(exports.parser=parser,exports.Parser=parser.Parser,exports.parse=function(){return parser.parse.apply(parser,arguments)},exports.main=function(a){a[1]||(console.log("Usage: "+a[0]+" FILE"),process.exit(1));a=require("fs").readFileSync(require("path").normalize(a[1]),"utf8");return exports.parser.parse(a)},"undefined"!==typeof module&&require.main===module&&exports.main(process.argv.slice(1)));function Term(a,b,c){switch(a){case Type.FreeVar:this.freevarRegistry=a=Object.create(null);b=new FreeVar(b,a);this.head=new Sentinel(b);break;case Type.AbsTerm:a=c;c=new AbsTerm(a.freevarRegistry[b]||[],a.head.child,b);this.head=new Sentinel(c);this.freevarRegistry=a.freevarRegistry;delete this.freevarRegistry[b];break;case Type.AppTerm:a=c;c=b.head;var d=a.head,e=new AppTerm(c.child,d.child);this.head=new Sentinel(e);c.child=null;d.child=null;this.freevarRegistry=b.freevarRegistry;this.mergeRegistries(a.freevarRegistry);
break;case Type.FunTerm:a=c;this.freevarRegistry=Object.create(null);c=[];for(d=0;d<a.length;++d)this.mergeRegistries(a[d].freevarRegistry),c.push(a[d].head.child);a=new FreeVar(b,this.freevarRegistry);b=new FunTerm(b,c,a);this.head=new Sentinel(b);break;case Type.LetAbbr:a=c;b=new LetAbbr(b,a.head);this.head=new Sentinel(b);this.freevarRegistry=a.freevarRegistry;break;case Type.StrTerm:b=new StrTerm(b);this.head=new Sentinel(b);this.freevarRegistry=Object.create(null);break;case Type.Int:b=new Int(b);
this.head=new Sentinel(b);this.freevarRegistry=Object.create(null);break;case Type.OpP:b=new OpP(b,c);this.head=new Sentinel(b);this.freevarRegistry=Object.create(null);break;default:this.head=new Sentinel(b),this.freevarRegistry=Object.create(null)}}
Term.prototype={constructor:Term,mergeRegistries:function(a){for(var b in a){this.freevarRegistry[b]||(this.freevarRegistry[b]=[]);for(var c=a[b],d=0;d<c.length;++d)this.freevarRegistry[b].push(c[d]),c[d].registry=this.freevarRegistry}},destroy:function(){this.head.softDestroy();this.head=this.freevarRegistry=null},contractHead:function(){this.head.child.contractRedex()},processAndReduce:function(a){for(var b=0,c=Utility.normalizeLimit,d=[this.head];d.length;){var e=d.pop();if(a(e)){if(b>=c)return!1;
var h=e.parent,s=h.children().indexOf(e);d.splice(-s,s);d.push(h);e.contractRedex();++b}else for(e=e.children(),h=0;h<e.length;++h)d.push(e[h])}return!0},normalize:function(){return this.processAndReduce(function(a){return a.isRedex()})},preprocess:function(){return this.processAndReduce(function(a){return a.isRedex()&&a.isPreproccessed()})},develop:function(){for(var a=[this.head],b=[];a.length;){var c=a.pop();c.isRedex()&&b.push(c);for(var c=c.children(),d=0;d<c.length;++d)a.push(c[d])}b=b.reverse();
for(d=0;d<b.length;++d)b[d].contractRedex()},makeJQueryHTMLObject:function(){return this.head.makeJQueryHTMLObject()}};Term.makeVar=function(a){return new Term(Type.FreeVar,a)};Term.makeApp=function(a,b){return new Term(Type.AppTerm,a,b)};Term.makeAbs=function(a,b){return new Term(Type.AbsTerm,a,b)};Term.makeFunction=function(a,b){return new Term(Type.FunTerm,a,b)};Term.makeLetAbbr=function(a,b){return new Term(Type.LetAbbr,a,b)};Term.makeString=function(a){return new Term(Type.StrTerm,a)};
Term.makeInt=function(a){return new Term(Type.Int,a)};Term.makeOp=function(a,b){return new Term(Type.OpP,a,b)};Term.makeConstant=function(a){if(void 0!=Term.constant[a])return a=Term.constant[a].head.child.cloneWithSideEffects(),new Term(-1,a);throw Error("Constant "+a+" not found");};
Term.constant={$true:Term.makeLetAbbr("$true",Term.makeAbs("x",Term.makeAbs("y",Term.makeVar("x")))),$false:Term.makeLetAbbr("$false",Term.makeAbs("x",Term.makeAbs("y",Term.makeVar("y")))),$I:Term.makeLetAbbr("$I",Term.makeAbs("x",Term.makeVar("x"))),$K:Term.makeLetAbbr("$K",Term.makeAbs("x",Term.makeAbs("y",Term.makeVar("x")))),$S:Term.makeLetAbbr("$S",parser.parse("\\x\\y\\z.x z .y z")),$Y:Term.makeLetAbbr("$Y",parser.parse("\\f.(\\x.f(x x))(\\x.f(x x))")),$B:Term.makeLetAbbr("$B",parser.parse("\\f\\g\\x.f.g(x)"))};
var LetExpr={contractLet:function(a,b,c){b=Term.makeLetAbbr(a,b);c=Term.makeAbs(a,c);a=Term.makeApp(c,b);a.contractHead();return a},contractFunLet:function(a,b,c){for(var d=a.varlist.reverse(),e=0;e<d.length;++e)b=Term.makeAbs(d[e],b);c=Term.makeAbs(a.name,c);c=Term.makeApp(c,b);c.contractHead();return c}};var $main,$debug,$normresult,$input;function setLimit(){var a=$("#normalizelimit").val();if(!/^\d+$/.test(a))return $normresult.text("Please enter a positive integer"),!1;Utility.normalizeLimit=a;return!0}function reset(){var a=$main.data("term");a&&(a.destroy(),$main.data("term",null),$main.empty(),Semantic.contract=[])}$(document).on("click","#newterm",function(){$debug.empty();$normresult.empty();reset();try{placeTerm(parser.parse($input.val()))}catch(a){$debug.text(a)}});
$(document).on("click","#normalize",function(){var a=$main.data("term");if(!a||!setLimit())return!1;a.normalize()?$normresult.text("Term normalized"):$normresult.text("Not normalized");placeTerm(a)});$(document).on("click","#develop",function(){var a=$main.data("term");if(!a)return!1;$normresult.empty();a.develop();placeTerm(a)});$(document).on("click","#preprocess",function(){var a=$main.data("term");if(!a||!setLimit())return!1;$normresult.empty();a.preprocess();placeTerm(a)});
$(document).on("keydown","textarea",function(a){if(9===a.keyCode){var b=this.selectionStart,c=this.selectionEnd,d=$(this),e=d.val();d.val(e.substring(0,b)+"\t"+e.substring(c));this.selectionStart=this.selectionEnd=b+1;a.preventDefault()}});
$(function(){$main=$("#main");$debug=$("#debug");$input=$("#termtextarea");$normresult=$("#normalresult");$("#newterm").click();$("#normalizelimit").on("keyup",function(a){if(13==a.which)return $("#normalize").click(),!1});$main.on("mouseover",".bindingspot",function(a){$(a.target).data("redex").illuminate();return!1});$main.on("mouseleave",".bindingspot",function(a){$(a.target).data("redex").unilluminate();return!1});$main.on("click",".bindingspot",function(a){var b=$(a.target).data("redex"),c=b.parent,
d=c.display;b.contractRedex();d?(c.makeJQueryHTMLObject(),d.replaceWith(c.display)):placeTerm($("#main").data("term"));a.preventDefault()})});function semanticAnalysis(a){return a}function placeTerm(a){$main.empty().append(a.makeJQueryHTMLObject()).data("term",a)};
